=================
TaxPulse PH Pack
=================

.. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

.. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
    :target: https://odoo-community.org/page/development-status
    :alt: Beta
.. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
    :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
    :alt: License: AGPL-3
.. |badge3| image:: https://img.shields.io/badge/github-jgtolentino%2FTaxPulse--PH--Pack-lightgray.png?logo=github
    :target: https://github.com/jgtolentino/TaxPulse-PH-Pack
    :alt: jgtolentino/TaxPulse-PH-Pack

|badge1| |badge2| |badge3|

Philippine BIR Tax Compliance & Multi-Agency Finance Automation for Odoo 18.0 Enterprise.

**Features**:

* BIR Form 1601-C: Monthly Withholding Tax (Compensation & Final)
* BIR Form 2550Q: Quarterly VAT Return
* BIR Form 1702-RT: Annual Income Tax Return
* Multi-agency support (8 agencies: RIM, CKVC, BOM, JPAL, JLI, JAP, LAS, RMQB)
* Real-time Supabase integration for data warehousing
* Automated tax computation from account moves
* Comprehensive BIR compliance reporting

**Table of contents**

.. contents::
   :local:

Installation
============

1. Clone this repository to your Odoo addons directory:

.. code-block:: bash

    cd /path/to/odoo/addons
    git clone https://github.com/jgtolentino/TaxPulse-PH-Pack.git

2. Install Python dependencies:

.. code-block:: bash

    pip install requests psycopg2-binary

3. Update the app list in Odoo and install the module

4. Configure Supabase integration:

.. code-block:: bash

    export SUPABASE_URL="https://xkxyvboeubffxxbebsll.supabase.co"
    export SUPABASE_SERVICE_ROLE_KEY="your-service-role-key"

5. Apply Supabase schema migrations:

.. code-block:: bash

    psql "$POSTGRES_URL" -f supabase/001_create_bir_tables.sql
    psql "$POSTGRES_URL" -f supabase/002_rpc_functions.sql

Configuration
=============

After installation:

1. Go to **Accounting > Configuration > TaxPulse > Agencies**
2. Verify that 8 agencies have been created automatically
3. Configure TIN and RDO codes for each agency
4. Map analytic accounts to agencies for expense tracking

Usage
=====

Creating BIR Forms
------------------

**BIR Form 1601-C (Monthly Withholding Tax)**:

1. Go to **Accounting > Philippine BIR > BIR 1601-C**
2. Click **Create**
3. Select agency, period start/end dates
4. Click **Compute from Account Moves** to auto-populate tax amounts
5. Add tax lines manually if needed
6. Click **Confirm** → **Post** to finalize

**BIR Form 2550Q (Quarterly VAT)**:

1. Go to **Accounting > Philippine BIR > BIR 2550Q**
2. Click **Create**
3. Select agency, quarter start/end dates
4. Enter output VAT and input VAT amounts
5. Click **Confirm** → **Post** to finalize

**BIR Form 1702-RT (Annual Income Tax)**:

1. Go to **Accounting > Philippine BIR > BIR 1702-RT**
2. Click **Create**
3. Select agency, fiscal year, period dates
4. Enter gross income, deductions, tax credits
5. Click **Confirm** → **Post** to finalize

Supabase Synchronization
-------------------------

All BIR forms are automatically synced to Supabase when posted.

To manually sync:

1. Open any BIR form
2. Click **Actions > Sync to Supabase**

To bulk sync all forms:

.. code-block:: python

    # In Odoo shell or external script
    sync_model = env['taxpulse.supabase.sync']
    results = sync_model.bulk_sync_all()

Reporting
---------

Print BIR forms:

1. Open the form (1601-C, 2550Q, or 1702-RT)
2. Click **Print** to generate PDF report

Finance Tax Pulse AI Review
---------------------------

When Supabase integration and the ``finance-tax-pulse`` Edge Function are
configured, you can trigger an AI-assisted compliance review for a given
entity and period.

**Setup:**

1. Apply the Tax Pulse schema migrations:

.. code-block:: bash

    psql "$POSTGRES_URL" -f supabase/003_tax_pulse_schema.sql
    psql "$POSTGRES_URL" -f supabase/004_tax_pulse_protocol_seed.sql

2. Deploy the Edge Function:

.. code-block:: bash

    supabase functions deploy finance-tax-pulse
    supabase secrets set LLM_API_KEY=your-api-key

**Triggering a Review:**

Call the Edge Function with:

- ``entity_id``: Agency code (RIM, CKVC, BOM, etc.)
- ``period_start`` / ``period_end``: Review period dates
- ``tax_types``: Array of form types (1601-C, 2550Q, 1702-RT)
- ``protocol_version``: Review protocol (default: v1)

.. code-block:: bash

    curl -X POST "$SUPABASE_URL/functions/v1/finance-tax-pulse" \
      -H "Authorization: Bearer $SUPABASE_ANON_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "entity_id": "RIM",
        "period_start": "2025-01-01",
        "period_end": "2025-03-31",
        "tax_types": ["1601-C", "2550Q"],
        "protocol_version": "v1"
      }'

The function will:

* Aggregate the relevant BIR forms and account moves
* Run them through the Finance Tax Pulse orchestrator (Claude/GPT)
* Score across 5 dimensions: Compliance, Numeric, Coverage, Timeliness, Clarity
* Store scores and memo in the ``tax_pulse_run_log`` table
* Return a structured JSON response with findings and recommendations

**Review Results:**

Query the run log for review history:

.. code-block:: sql

    SELECT entity_id, run_ts, score_compliance, score_numeric,
           weakest_dimension, memo_summary
    FROM tax_pulse_run_log
    WHERE entity_id = 'RIM'
    ORDER BY run_ts DESC;

See ``specs/002_finance_tax_pulse.md`` for full documentation.

Bug Tracker
===========

Bugs are tracked on `GitHub Issues <https://github.com/jgtolentino/TaxPulse-PH-Pack/issues>`_.

In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us smashing it by providing a detailed and welcomed
`feedback <https://github.com/jgtolentino/TaxPulse-PH-Pack/issues/new?body=module:%20TaxPulse-PH-Pack%0Aversion:%2018.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.

Do not contact contributors directly about support or help with technical issues.

Credits
=======

Authors
~~~~~~~

* InsightPulse AI Finance SSC
* Jake Tolentino

Contributors
~~~~~~~~~~~~

* Jake Tolentino <jgtolentino@example.com>

Maintainers
~~~~~~~~~~~

This module is maintained by InsightPulse AI Finance Shared Service Center.

.. image:: https://insightpulseai.net/logo.png
   :alt: InsightPulse AI
   :target: https://insightpulseai.net

InsightPulse AI is a multi-agency Finance SSC providing comprehensive BIR compliance and tax automation solutions.

This module is part of the `jgtolentino/TaxPulse-PH-Pack <https://github.com/jgtolentino/TaxPulse-PH-Pack>`_ project on GitHub.

You are welcome to contribute.
